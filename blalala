#include <stdio.h>
#include <unistd.h>
#include <pthread.h>

int counter = 0;
pthread_mutex_t lock;  // TODO: ประกาศ mutex

void* increment(void* arg) {
    for (int i = 0; i < 100000; i++) {
        // TODO: ลองใส่ pthread_mutex_lock ที่นี่
        counter++;
        // TODO: แล้วตามด้วย pthread_mutex_unlock
    }
    return NULL;
}

int main() {
    pthread_t t1, t2;

    // TODO: initialize mutex
    // pthread_mutex_init( ... );

    pthread_create(&t1, NULL, increment, NULL);
    pthread_create(&t2, NULL, increment, NULL);

    pthread_join(t1, NULL);
    pthread_join(t2, NULL);

    // TODO: destroy mutex

    printf("Final counter = %d\n", counter);
    return 0;
}

#include <stdio.h>
#include <unistd.h>
#include <pthread.h>

int counter = 0;
pthread_mutex_t lock;  // TODO: ประกาศ mutex เรียบร้อยแล้ว

void* increment(void* arg) {
    for (int i = 0; i < 100000; i++) {
        // TODO: ล็อก Mutex ก่อนเข้า Critical Section
        pthread_mutex_lock(&lock);
        
        counter++;
        
        // TODO: ปลดล็อก Mutex หลังทำงานเสร็จ
        pthread_mutex_unlock(&lock);
    }
    return NULL;
}

int main() {
    pthread_t t1, t2;

    // TODO: initialize mutex
    pthread_mutex_init(&lock, NULL);

    pthread_create(&t1, NULL, increment, NULL);
    pthread_create(&t2, NULL, increment, NULL);

    pthread_join(t1, NULL);
    pthread_join(t2, NULL);

    // TODO: destroy mutex เพื่อคืนทรัพยากร
    pthread_mutex_destroy(&lock);

    printf("Final counter = %d\n", counter);
    return 0;
}

#include <stdio.h>
#include <unistd.h>
#include <pthread.h>

int counter = 0;
pthread_mutex_t lock;  // TODO: ประกาศ mutex เรียบร้อยแล้ว

void* increment(void* arg) {
    // ล็อก Mutex ก่อนเริ่ม Loop ครั้งเดียว
    pthread_mutex_lock(&lock);
    
    for (int i = 0; i < 100000; i++) {
        counter++; // ทำงานรวดเดียวจนจบ
    }
    
    // ปลดล็อกหลังจากทำ Loop เสร็จสิ้นทั้งหมด
    pthread_mutex_unlock(&lock);
    
    return NULL;
}

int main() {
    pthread_t t1, t2;

    // TODO: initialize mutex
    pthread_mutex_init(&lock, NULL);

    pthread_create(&t1, NULL, increment, NULL);
    pthread_create(&t2, NULL, increment, NULL);

    pthread_join(t1, NULL);
    pthread_join(t2, NULL);

    // TODO: destroy mutex เพื่อคืนทรัพยากร
    pthread_mutex_destroy(&lock);

    printf("Final counter = %d\n", counter);
    return 0;
}
